---
title: "NYC Restaurant Inspection Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(tidyverse)
library(p8105.datasets)
library(plotly)
library(flexdashboard)
```

```{r reorganize data for chart A, include = FALSE}
data("rest_inspec")

cuisine_desc = rest_inspec %>% 
  group_by(cuisine_description) %>%
  summarise(count = n()) %>%
  arrange(desc(count)) %>%
  mutate(is_other = ifelse(count < 10000, "yes", "no"))

cuisine_other = cuisine_desc %>%
filter(is_other == "yes") %>%
mutate(total_count = sum(count))
```


Column {data-width=650}
-----------------------------------------------------------------------



### Chart A

```{r, include = FALSE}
most_cuisine = cuisine_desc %>%
  filter(is_other == "no") %>%
  add_row(cuisine_description = "other restaurant",
          count = sum(cuisine_other$count)) %>%
  select(cuisine_description, count)
```

```{r}
  plot_ly(most_cuisine, labels = ~cuisine_description, values = ~count, type = 'pie') %>%
  layout(title = 'Cuisines categories with violations')
```


```{r reorganize data for chart B, include = FALSE}
boro_inspec = rest_inspec %>% 
  drop_na(score) %>% 
  select(boro, score) %>%
  filter(boro %in% c("MANHATTAN", "BRONX", "BROOKLYN", "QUEENS", "STATEN ISLAND")) %>%
  mutate(boro = fct_reorder(boro, score)) 
```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}
boro_inspec %>%
  plot_ly(y = ~score, color = ~boro, type = "box") %>%
  layout(title = "Inspection score by boroughs",
         xaxis = list(title = "Borough name")) 
```


### Chart C
```{r}
rest_inspec %>% 
   filter(boro %in% c("MANHATTAN", "BRONX", "BROOKLYN", "QUEENS", "STATEN ISLAND")) %>% 
  count(street) %>%
  mutate(street = fct_reorder(street, n)) %>%
  arrange(desc(n)) %>%
  filter(n > 2000) %>%
  plot_ly(x = ~street, y = ~n,
          type = "bar") %>%
  layout(title = 'Inspect results by streets violations(>2000)',
         xaxis = list(title = "Street name"),
         yaxis = list(title = "violations counts"))

```

